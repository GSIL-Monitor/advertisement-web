<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="agency">

	<resultMap id="agencyMap" type="Agency">
		<id property="userId" column="user_id" jdbcType="VARCHAR" />
		<result property="inviteUserId" column="invite_user_id" jdbcType="VARCHAR" />
		<result property="agencyName" column="agency_name" jdbcType="VARCHAR" />
		<result property="userName" column="user_name" jdbcType="VARCHAR" />
		<result property="inviteTime" column="invite_time" jdbcType="TIMESTAMP" />
		<result property="brokerage" column="brokerage" jdbcType="NUMERIC" />
		<result property="status" column="status" jdbcType="NUMERIC" />
		<result property="productId" column="product_id" jdbcType="NUMERIC" />
		<result property="productName" column="product_name" jdbcType="NUMERIC" />
	</resultMap>

<!--查询直推总佣金-->
	<select id="getAgencyBrokerage" parameterType="java.lang.Long" resultType="java.math.BigDecimal">
		select
		sum(brokerage) from
		tb_agency
		where
			invite_user_id =#{inviteUserId}

	</select>

<!--	<select id="selectAgencysByInviteId" parameterType="java.lang.Long" resultMap="agencyMap">
		select
		* from
		tb_agency
		invite_id = #{inviteId}
	</select>-->

	<!-- 查询sql -->
	<select id="selectAgencys" parameterType="Agency" resultMap="agencyMap">
		select
		* from
		tb_agency
		<where>
			<trim suffixOverrides="and">
				<if test="inviteUserId != null">
					invite_user_id= #{inviteUserId} and
				</if>
				<if test="userId != null">
					user_id= #{userId} and
				</if>
				<if test="agencyName != null">
					agency_name= #{agencyName} and
				</if>
				<if test="userName != null">
					user_name= #{userName} and
				</if>
				<if test="inviteTime != null">
					invite_time= #{inviteTime} and
				</if>
				<if test="brokerage != null"> and
					brokerage= #{brokerage}
				</if>
				<if test="productId != null"> and
					product_id= #{productId}
				</if>
				<if test="productName != null"> and
					product_name= #{productName}
				</if>
				<if test="status != null"> and
					status= #{status}
				</if>

			</trim>

		</where>
		order by invite_time desc
	</select>

	<insert id="insertAgency" parameterType="Agency">
		insert into
		tb_agency(user_id,invite_user_id,user_name,invite_name,brokerage,product_id,product_name,invite_time,status)
		values
		(#{userId}, #{inviteUserId}, #{userName}, #{invateName},#{brokerage},#{productId},#{productName},
		#{inviteTime},#{status})
		<selectKey resultType="java.lang.Long" order="AFTER"
				   keyProperty="userId">
			SELECT LAST_INSERT_ID()
		</selectKey>
	</insert>


</mapper>